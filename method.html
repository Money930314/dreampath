<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ–¹æ³•å°è®€ â€” DreamPath</title>
  <style>
    :root{ --bg:#0f172a; --panel:#0b1220; --text:#e5e7eb; --muted:#94a3b8; --border:rgba(148,163,184,.18); --primary:#667eea; --accent:#764ba2; --ring:rgba(102,126,234,.35) }
    *{box-sizing:border-box} body{margin:0; background:var(--bg); color:var(--text); font-family:ui-sans-serif,system-ui,"Noto Sans TC",Arial}
    a{color:#c7d2fe; text-decoration:none}
    .shell{max-width:1100px; margin:0 auto; padding:20px 16px 60px}
    header{display:flex; align-items:center; justify-content:space-between; gap:16px; padding:12px 0}
    .brand{display:flex; align-items:center; gap:12px}
    .logo{width:44px; height:44px; border-radius:12px; background:linear-gradient(135deg,var(--primary),var(--accent)); display:grid; place-items:center; font-weight:800; color:white}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02)); border:1px solid var(--border); border-radius:16px; padding:18px; box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .btn{appearance:none; border:1px solid var(--border); background:#0b1220; color:#e5e7eb; padding:10px 14px; border-radius:12px; cursor:pointer; font-weight:600}
    .btn.primary{background:linear-gradient(135deg,var(--primary),var(--accent)); border:0}
    .grid{display:grid; grid-template-columns:repeat(12,1fr); gap:12px}
    .col-7{grid-column:span 7} .col-5{grid-column:span 5}
    @media (max-width: 900px){ .col-7,.col-5{grid-column:1/-1} }
    label{display:block; font-size:12px; color:#a3b3c7; margin-bottom:6px}
    input,textarea,select{width:100%; padding:10px 12px; border-radius:12px; background:#0b1220; color:#e5e7eb; border:1px solid var(--border)}
    input:focus,textarea:focus{border-color:var(--ring); box-shadow:0 0 0 4px rgba(102,126,234,.15)}
    .muted{color:#94a3b8}
    canvas{width:100%; height:180px; background:#0b1220; border:1px solid var(--border); border-radius:12px}
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="brand">
        <div class="logo">DP</div>
        <div>
          <div style="font-weight:700" id="methodTitle">æ–¹æ³•å°è®€</div>
          <div class="muted" id="methodDesc" style="font-size:12px"></div>
        </div>
      </div>
      <div class="row"><a class="btn" href="templates.html">â† å›æ¨¡æ¿åº«</a> <a class="btn" href="index.html">å› Dashboard</a></div>
    </header>

    <!-- æ–¹æ³•ç°¡ä»‹ -->
    <section class="card" id="intro"></section>

    <div class="grid" style="margin-top:12px">
      <!-- è¦–è¦ºåŒ– Dashboard -->
      <section class="card col-7">
        <div style="font-weight:700; margin-bottom:6px">ğŸ“Š å°ˆå±¬ Dashboard</div>
        <div class="muted" style="font-size:12px; margin-bottom:8px">æŒ‡æ¨™æœƒæ ¹æ“šä½ å¡«å¯«çš„å¼•å°å•é¡Œèˆ‡ä»»å‹™é€²åº¦å³æ™‚è®ŠåŒ–ã€‚</div>
        <div style="display:grid; grid-template-columns:1fr; gap:10px">
          <canvas id="chart1"></canvas>
          <canvas id="chart2"></canvas>
        </div>
      </section>

      <!-- å¼•å°å•ç­”è¡¨å–® -->
      <section class="card col-5">
        <div style="font-weight:700; margin-bottom:6px">ğŸ§­ å¼•å°å•é¡Œ</div>
        <form id="guideForm" class="list"></form>
        <div style="display:flex; gap:10px; justify-content:flex-end">
          <button class="btn" onclick="previewPlan(event)">é è¦½è¨ˆç•«</button>
          <button class="btn primary" onclick="createPlan(event)">ä¸€éµå»ºç«‹è¨ˆç•«</button>
        </div>
      </section>
    </div>
  </div>

<script>
// ===== å·¥å…· =====
const qs = (k)=> new URL(location.href).searchParams.get(k);
const uid = ()=> (crypto.randomUUID ? crypto.randomUUID() : Date.now()+"-"+Math.random().toString(16).slice(2));
const todayISO = ()=> new Date().toISOString().slice(0,10);
const load = (k, f)=>{ try{return JSON.parse(localStorage.getItem(k)) ?? f}catch(e){return f} };
const save = (k,v)=> localStorage.setItem(k, JSON.stringify(v));
let state = load('dreampath', {goals:[], tasks:[], points:0, activeGoalId:null});
if(!Array.isArray(state.tasks)) state.tasks=[];

// ===== æ–¹æ³•å®šç¾©ï¼ˆ19 ç¨®ï¼‰ =====
const METHODS = {
  smart:{name:'SMART ç›®æ¨™', desc:'Specific/Measurable/Achievable/Relevant/Time-bound',
    intro:['æŠŠé¡˜æœ›æ”¹å¯«ç‚ºå¯é‡æ¸¬ã€å¯é©—æ”¶çš„æ˜ç¢ºç›®æ¨™','ä»¥ S/M/A/R/T äº”æŒ‡æ¨™è‡ªæˆ‘æª¢æ ¸'],
    questions:[
      {k:'specific', l:'ä½ çš„ç›®æ¨™å…·é«”æ˜¯ä»€éº¼ï¼Ÿ(S)'},
      {k:'measurable', l:'ä½ å¦‚ä½•è¡¡é‡è‡ªå·±é”æˆäº†ï¼Ÿ(M)'},
      {k:'achievable', l:'ä»¥ä½ ç›®å‰è³‡æºï¼Œé€™å¯è¡Œå—ï¼Ÿ(A)'},
      {k:'relevant', l:'ç‚ºä½•æ­¤ç›®æ¨™å°ä½ é‡è¦ï¼Ÿ(R)'},
      {k:'time', l:'ä½ å¸Œæœ›åœ¨ä»€éº¼æ™‚é–“é”æˆï¼Ÿ(T)'}
    ],
    makeTasks:(g,v)=>{
      const out=[]; for(let i=1;i<=4;i++){ const d=new Date(); d.setDate(d.getDate()+i*7);
        out.push({id:uid(),goal_id:g.id,title:`SMART é€±æª¢æ ¸ ${i}/4`,type:'milestone',estimate_min:45,due_date:d.toISOString().slice(0,10),status:'pending'}); }
      out.push({id:uid(),goal_id:g.id,title:`å•Ÿå‹•ï¼šæ’°å¯« SMART èªªæ˜ï¼ˆ${v.measurable||'å®šç¾©æŒ‡æ¨™'}ï¼‰`,type:'start',estimate_min:20,due_date:todayISO(),status:'pending'});
      return out;
    },
    charts:(ctx1,ctx2)=>{ ring(ctx1, 68, 'SMART å®Œæ•´åº¦'); spark(ctx2,[20,40,55,68,70,76,82], 'é€²åº¦è¶¨å‹¢'); }
  },
  pomodoro:{name:'ç•ªèŒ„å·¥ä½œæ³•', desc:'25/50 åˆ†å°ˆæ³¨ + çŸ­ä¼‘',
    intro:['ä»¥çŸ­å›åˆé™ä½å•Ÿå‹•æˆæœ¬','æ¯å®Œæˆä¸€å€‹ç•ªèŒ„ç«‹å³å›é¥‹'],
    questions:[{k:'target',l:'ä»Šå¤©è¦å°ˆæ³¨å®Œæˆçš„ä»»å‹™ï¼Ÿ'},{k:'rounds',l:'éœ€è¦å¹¾å€‹ç•ªèŒ„ï¼Ÿ(æ•¸å­—)'}],
    makeTasks:(g,v)=>{ const n=Math.max(1,parseInt(v.rounds||'4',10)); const out=[]; for(let i=1;i<=n;i++) out.push({id:uid(),goal_id:g.id,title:`ç•ªèŒ„ ${i}/${n}ï¼š${v.target||'é‡é»ä»»å‹™'}`,type:'pomodoro',estimate_min:25,due_date:todayISO(),status:'pending'}); return out;},
    charts:(ctx1,ctx2)=>{ ring(ctx1, 2, 'ä»Šæ—¥ç•ªèŒ„'); bars(ctx2,[1,3,2,4,5,3,2],'è¿‘ 7 æ—¥ç•ªèŒ„'); }
  },
  zeigarnik:{name:'Zeigarnik æ•ˆæ‡‰', desc:'æœªå®Œæˆçš„äº‹ï¼Œæ›´æŠ“å¿ƒç¥',
    intro:['åªéœ€å•Ÿå‹•ç¬¬ä¸€æ­¥ï¼Œé™ä½å¿ƒæ™ºè² è·','å»ºç«‹é–‹æ”¾è¿´è·¯æ¸…å–®ä»¥æŒçºŒæ¨é€²'],
    questions:[{k:'first',l:'åªéœ€é–‹å§‹çš„ç¬¬ä¸€å€‹æœ€å°æ­¥é©Ÿæ˜¯ï¼Ÿ'},{k:'next',l:'ä¸‹ä¸€å€‹æ¥çºŒæ­¥é©Ÿæ˜¯ï¼Ÿ'}],
    makeTasks:(g,v)=>[{id:uid(),goal_id:g.id,title:`å…ˆå•Ÿå‹•ï¼š${v.first||'ç¬¬ä¸€æ­¥'}`,type:'start',estimate_min:15,due_date:todayISO(),status:'pending'},{id:uid(),goal_id:g.id,title:`æ¥çºŒï¼š${v.next||'ä¸‹ä¸€æ­¥'}`,type:'follow',estimate_min:20,due_date:todayISO(),status:'pending'}],
    charts:(c1,c2)=>{ ring(c1, 1, 'å•Ÿå‹•æ•¸'); spark(c2,[0,1,1,2,2,3,3],'é–‹æ”¾è¿´è·¯'); }
  },
  mbo:{name:'MBO ç›®æ¨™ç®¡ç†', desc:'ä¸»ç›®æ¨™â†’å­ç›®æ¨™â†’è²¬ä»»',
    intro:['å±¤ç´šåˆ†è§£ï¼Œè²¬ä»»æ¸…æ™°','å­ç›®æ¨™è²¢ç»ä¸»ç›®æ¨™'],
    questions:[{k:'main',l:'ä¸»ç›®æ¨™æ˜¯ï¼Ÿ'},{k:'sub1',l:'å­ç›®æ¨™ 1ï¼Ÿ'},{k:'sub2',l:'å­ç›®æ¨™ 2ï¼Ÿ'},{k:'sub3',l:'å­ç›®æ¨™ 3ï¼Ÿ'}],
    makeTasks:(g,v)=>['sub1','sub2','sub3'].map((k,i)=>({id:uid(),goal_id:g.id,title:`å»ºç«‹å­ç›®æ¨™ ${i+1}ï¼š${v[k]||'æœªå‘½å'}`,type:'mbo',estimate_min:40,due_date:todayISO(),status:'pending'})),
    charts:(c1,c2)=>{ bars(c1,[30,40,20],'å­ç›®æ¨™è²¢ç»'); ring(c2, 12, 'æœ¬é€±æ¨é€²'); }
  },
  eisenhower:{name:'è‰¾æ£®è±ªçŸ©é™£', desc:'é‡è¦ Ã— ç·Šæ€¥ å››è±¡é™',
    intro:['è¾¨è­˜å‡ç·Šæ€¥ã€é‡‹æ”¾ Q2 é•·æœŸåƒ¹å€¼'],
    questions:[{k:'q1',l:'Q1 é‡è¦ä¸”ç·Šæ€¥ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰'},{k:'q2',l:'Q2 é‡è¦ä¸ç·Šæ€¥'},{k:'q3',l:'Q3 ä¸é‡è¦ä½†ç·Šæ€¥'},{k:'q4',l:'Q4 ä¸é‡è¦ä¸ç·Šæ€¥'}],
    makeTasks:(g,v)=>{ const out=[]; const add=(k,p)=> (v[k]||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(x=> out.push({id:uid(),goal_id:g.id,title:`[${p}] ${x}`,type:'task',estimate_min:25,due_date:todayISO(),status:'pending'})); add('q1','ç«‹å³åš'); add('q2','æ’ç¨‹'); add('q3','å§”æ´¾'); return out; },
    charts:(c1,c2)=>{ quad(c1,{q1:2,q2:5,q3:1,q4:0}); spark(c2,[2,3,5,6,4,5,7],'å®Œæˆæ•¸'); }
  },
  parkinson:{name:'å¸•é‡‘æ£®æ³•å‰‡', desc:'é™æ™‚å£“ç¸®æé«˜æ•ˆç‡',
    intro:['æ™‚é–“è¶ŠçŸ­è¶Šå°ˆæ³¨','æŒ‘æˆ°é™æ™‚ç‰ˆå®Œæˆ'],
    questions:[{k:'task',l:'è¦é™æ™‚å®Œæˆçš„ä»»å‹™ï¼Ÿ'},{k:'limit',l:'é™å®šåˆ†é˜æ•¸ï¼ˆæ•¸å­—ï¼‰'}],
    makeTasks:(g,v)=>[{id:uid(),goal_id:g.id,title:`é™æ™‚ ${parseInt(v.limit||'40',10)} åˆ†é˜ï¼š${v.task||'ç›®æ¨™ä»»å‹™'}`,type:'timebox',estimate_min:parseInt(v.limit||'40',10),due_date:todayISO(),status:'pending'}],
    charts:(c1,c2)=>{ ring(c1, 80, 'æ™‚é–“å£“ç¸®ç‡'); bars(c2,[60,50,45,40],'æŒ‘æˆ°æ­·å²(åˆ†)'); }
  },
  kaizen:{name:'Kaizen æ”¹å–„', desc:'æ¯æ—¥ 1% å¾®é€²æ­¥',
    intro:['æœ€å°å¯è¡Œè¡Œå‹• â‰¤5 åˆ†é˜','ä»¥æ‰“å¡ç´¯ç©è¤‡åˆ©'],
    questions:[{k:'micro',l:'ä»Šå¤©æœ€å°å¯è¡Œè¡Œå‹•ï¼Ÿ(â‰¤5 åˆ†)'},{k:'reason',l:'ç‚ºä»€éº¼é€™ä»¶äº‹é‡è¦ï¼Ÿ'}],
    makeTasks:(g,v)=>{ const out=[]; for(let i=0;i<7;i++){ const d=new Date(); d.setDate(d.getDate()+i); out.push({id:uid(),goal_id:g.id,title:`å¾®é€²æ­¥ï¼š${v.micro||'è¡Œå‹•'}`,type:'kaizen',estimate_min:5,due_date:d.toISOString().slice(0,10),status:'pending'});} return out;},
    charts:(c1,c2)=>{ spark(c1,[1,1,1,1,1,1,1],'é€£å‹'); ring(c2, 5, 'ä»Šæ—¥æ‰“å¡(åˆ†)'); }
  },
  gtd:{name:'GTD', desc:'æ”¶é›†â†’é‡æ¸…â†’çµ„ç¹”â†’å›é¡§â†’åŸ·è¡Œ',
    intro:['å¸è¼‰è…¦ä¸­å¾…è¾¦ï¼Œé™ä½ç„¦æ…®','ç”¨é€±å›é¡§ç¶­æŒç³»çµ±å¯ä¿¡åº¦'],
    questions:[{k:'inbox',l:'è…¦ä¸­å¾…è¾¦ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰'},{k:'next',l:'ä¸‹ä¸€æ­¥è¡Œå‹•ï¼ˆ1~3 ä»¶ï¼‰'}],
    makeTasks:(g,v)=>{ const out=[];(v.inbox||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(x=> out.push({id:uid(),goal_id:g.id,title:`æ”¶é›†ï¼š${x}`,type:'gtd',estimate_min:10,due_date:todayISO(),status:'pending'})); (v.next||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(x=> out.push({id:uid(),goal_id:g.id,title:`Nextï¼š${x}`,type:'gtd',estimate_min:20,due_date:todayISO(),status:'pending'})); return out;},
    charts:(c1,c2)=>{ bars(c1,[5,3,2,1],'å¾…è¾¦è™•ç†'); spark(c2,[0,2,4,5,6,7,9],'æ”¶é›†é‡'); }
  },
  okr:{name:'OKRï¼ˆå­£ï¼‰', desc:'Objective + Key Results',
    intro:['ç”¨ KR é‡åŒ–æˆåŠŸ','æ¯é€±æ ¡æº–ï¼Œæ¯å­£æ»¾å‹•'],
    questions:[{k:'objective',l:'æœ¬å­£ Objectiveï¼Ÿ'},{k:'kr1',l:'KR1'},{k:'kr2',l:'KR2'},{k:'kr3',l:'KR3ï¼ˆå¯é¸ï¼‰'}],
    makeTasks:(g,v)=>{ const out=[]; [v.kr1,v.kr2,v.kr3].filter(Boolean).forEach((kr,idx)=>{ for(let w=1;w<=6;w++){ const d=new Date(); d.setDate(d.getDate()+w*7); out.push({id:uid(),goal_id:g.id,title:`KR${idx+1}ï¼š${kr}ï¼ˆé€± ${w}/6ï¼‰`,type:'okr',estimate_min:60,due_date:d.toISOString().slice(0,10),status:'pending'}); }}); return out;},
    charts:(c1,c2)=>{ bars(c1,[10,30,50,60],'KR é€²åº¦(%)'); spark(c2,[10,18,36,44,52,60,68],'è¶¨å‹¢'); }
  },
  ifthen:{name:'Ifâ€“Then å¯¦è¡Œæ„åœ–', desc:'If æƒ…å¢ƒ â†’ Then è¡Œç‚º',
    intro:['æŠŠé«˜é¢¨éšªè§¸ç™¼èˆ‡æ›¿ä»£è¡Œç‚ºç¶å®š','æƒ…å¢ƒä¸€åˆ°è‡ªå‹•å•Ÿå‹•'],
    questions:[{k:'trigger',l:'If è§¸ç™¼æƒ…å¢ƒï¼Ÿ'},{k:'action',l:'Then è¡Œç‚ºï¼Ÿ'}],
    makeTasks:(g,v)=>{ const out=[]; for(let i=0;i<14;i++){ const d=new Date(); d.setDate(d.getDate()+i); out.push({id:uid(),goal_id:g.id,title:`If ${v.trigger||'æƒ…å¢ƒ'} â†’ Then ${v.action||'è¡Œç‚º'}`,type:'if-then',estimate_min:10,due_date:d.toISOString().slice(0,10),status:'pending'});} return out;},
    charts:(c1,c2)=>{ ring(c1, 40, 'åŸ·è¡Œç‡'); spark(c2,[0,1,1,1,2,2,3],'è§¸ç™¼æ¬¡æ•¸'); }
  },
  woop:{name:'WOOP / MCII', desc:'é¡˜æœ›â†’çµæœâ†’éšœç¤™â†’è¨ˆç•«',
    intro:['å¿ƒç†å°æ¯” + å¦‚æœé‚£éº¼è¨ˆç•«ï¼Œæå‡è½åœ°ç‡'],
    questions:[{k:'wish',l:'é¡˜æœ›ï¼ˆWishï¼‰ï¼Ÿ'},{k:'outcome',l:'æœ€å¥½çµæœï¼ˆOutcomeï¼‰ï¼Ÿ'},{k:'obstacle',l:'ä¸»è¦éšœç¤™ï¼ˆObstacleï¼‰ï¼Ÿ'},{k:'plan',l:'å¦‚æœé‡åˆ°éšœç¤™ï¼Œè¨ˆç•«æ˜¯ï¼Ÿï¼ˆPlanï¼‰'}],
    makeTasks:(g,v)=>{ const out=[]; for(let i=0;i<3;i++){ const d=new Date(); d.setDate(d.getDate()+i*2); out.push({id:uid(),goal_id:g.id,title:`å…‹æœéšœç¤™ï¼š${v.obstacle||'éšœç¤™'} â†’ ${v.plan||'å°ç­–'}`,type:'woop',estimate_min:30,due_date:d.toISOString().slice(0,10),status:'pending'});} return out;},
    charts:(c1,c2)=>{ bars(c1,[20,40,60],'éšœç¤™å…‹æœç‡'); ring(c2, 55, 'ä¿¡å¿ƒæŒ‡æ•¸'); }
  },
  tmt:{name:'TMT æš«æ™‚å‹•æ©Ÿ', desc:'EÃ—V/(DÃ—I)',
    intro:['ç¸®çŸ­å»¶é²ã€æé«˜ç«‹å³å›é¥‹ï¼Œé¡¯è‘—é™ä½æ‹–å»¶'],
    questions:[{k:'expectancy',l:'æœŸå¾…å€¼ E (0â€“10)'},{k:'value',l:'åƒ¹å€¼ V (0â€“10)'},{k:'delay',l:'å»¶é² D (å¤©)'},{k:'impuls',l:'è¡å‹•æ€§ I (0â€“10)'},{k:'shorten',l:'å¦‚ä½•æŠŠä»»å‹™åˆ‡å°ï¼ˆâ‰¤40 åˆ†ï¼‰ï¼Ÿ'},{k:'feedback',l:'å¦‚ä½•æ›´å¿«å¾—åˆ°å›é¥‹ï¼Ÿ'}],
    makeTasks:(g,v)=>[{id:uid(),goal_id:g.id,title:`åˆ‡å°ï¼š${v.shorten||'åˆ‡æˆ 30â€“40 åˆ†'}`,type:'tmt',estimate_min:30,due_date:todayISO(),status:'pending'},{id:uid(),goal_id:g.id,title:`å¿«é€Ÿå›é¥‹ï¼š${v.feedback||'ç”¨ç•ªèŒ„å›é¥‹'}`,type:'tmt',estimate_min:20,due_date:todayISO(),status:'pending'}],
    charts:(c1,c2)=>{ ring(c1, 72, 'å‹•æ©ŸæŒ‡æ•¸'); spark(c2,[50,55,60,66,70,72,74],'æ³¢å‹•'); }
  },
  fogg:{name:'Fogg è¡Œç‚ºæ¨¡å‹', desc:'å‹•æ©Ÿ Ã— èƒ½åŠ› Ã— æç¤º',
    intro:['èª¿æ•´é›£åº¦èˆ‡æç¤ºï¼Œè¶…éè¡Œå‹•è‡¨ç•Œç·š'],
    questions:[{k:'motivation',l:'å‹•æ©Ÿ(0â€“10)'},{k:'ability',l:'èƒ½åŠ›/å®¹æ˜“åº¦(0â€“10)'},{k:'prompt',l:'å“ªç¨®æç¤ºæœ€æœ‰æ•ˆï¼Ÿ'}],
    makeTasks:(g,v)=>[{id:uid(),goal_id:g.id,title:`é™ä½é›£åº¦ï¼šæŠŠä»»å‹™æ”¹ç‚º 10 åˆ†é˜ç‰ˆ`,type:'fogg',estimate_min:10,due_date:todayISO(),status:'pending'},{id:uid(),goal_id:g.id,title:`è¨­å®šæç¤ºï¼š${v.prompt||'æ‰‹æ©Ÿé¬§é˜/æ—¥æ›†'}`,type:'fogg',estimate_min:5,due_date:todayISO(),status:'pending'}],
    charts:(c1,c2)=>{ bars(c1,[v2n('motivation'),v2n('ability')],'M/A'); ring(c2, 60, 'æç¤ºæœ‰æ•ˆåº¦'); }
  },
  commit:{name:'æ‰¿è«¾è£ç½®', desc:'æŠ¼é‡‘/æ‡²ç½°/å…¬é–‹æ‰¿è«¾',
    intro:['é‹ç”¨æå¤±è¶¨é¿ï¼Œè®“æœªä¾†çš„è‡ªå·±ç¶ä½ç¾åœ¨çš„è‡ªå·±'],
    questions:[{k:'stake',l:'å¤±æ•—æˆæœ¬ï¼ˆæŠ¼é‡‘/è™•ç½°ï¼‰'},{k:'referee',l:'è¦‹è­‰äºº/ç¾¤çµ„'}],
    makeTasks:(g,v)=>{ const out=[]; for(let w=1;w<=4;w++){ const d=new Date(); d.setDate(d.getDate()+w*7); out.push({id:uid(),goal_id:g.id,title:`æ‰¿è«¾æª¢è¦– W${w}`,type:'commit',estimate_min:15,due_date:d.toISOString().slice(0,10),status:'pending'});} return out;},
    charts:(c1,c2)=>{ ring(c1, 20, 'æ‰¿è«¾é€²åº¦'); spark(c2,[0,1,1,2,2,3,3],'å›å ±æ¬¡æ•¸'); }
  },
  nudge:{name:'åŠ©æ¨ç†è«–', desc:'é è¨­/æé†’/ç’°å¢ƒè¨­è¨ˆ',
    intro:['ç”¨é è¨­é¸é …èˆ‡æé†’ï¼Œè®“å¥½é¸æ“‡æ›´å®¹æ˜“'],
    questions:[{k:'default',l:'ä½ å¸Œæœ›ç³»çµ±å¹«ä½ é è¨­ä»€éº¼ï¼Ÿ'},{k:'remind',l:'åå¥½æé†’é »ç‡ï¼Ÿï¼ˆæ¯æ—¥/æ¯é€±ï¼‰'}],
    makeTasks:(g,v)=>[{id:uid(),goal_id:g.id,title:`è¨­å®šé è¨­è¡Œç‚ºï¼š${v.default||'æ¯å¤© 15 åˆ†é˜é–±è®€'}`,type:'nudge',estimate_min:10,due_date:todayISO(),status:'pending'},{id:uid(),goal_id:g.id,title:`å»ºç«‹æé†’ï¼š${v.remind||'æ¯æ—¥'}`,type:'nudge',estimate_min:5,due_date:todayISO(),status:'pending'}],
    charts:(c1,c2)=>{ spark(c1,[1,2,3,3,4,5,6],'æé†’å›æ‡‰'); ring(c2, 35, 'æ¡ç´ç‡'); }
  },
  deepwork:{name:'æ·±åº¦å·¥ä½œ', desc:'é•·æ™‚æ®µé«˜å°ˆæ³¨',
    intro:['é ç´„æ·±åº¦æ™‚æ®µã€é—œé–‰å¹²æ“¾ã€æ˜ç¢ºè¼¸å‡º'],
    questions:[{k:'block',l:'æ·±åº¦å·¥ä½œæ™‚æ®µï¼ˆå¦‚ 09:00â€“11:00ï¼‰'},{k:'output',l:'ä»Šæ—¥é æœŸè¼¸å‡ºï¼Ÿ'}],
    makeTasks:(g,v)=>[{id:uid(),goal_id:g.id,title:`æ·±åº¦å·¥ä½œï¼š${v.block||'å…©å°æ™‚'}`,type:'deepwork',estimate_min:90,due_date:todayISO(),status:'pending'},{id:uid(),goal_id:g.id,title:`è¼¸å‡ºï¼š${v.output||'ç« ç¯€åˆç¨¿/ç¨‹å¼æ¨¡çµ„'}`,type:'deepwork',estimate_min:30,due_date:todayISO(),status:'pending'}],
    charts:(c1,c2)=>{ bars(c1,[2,3,2,4,3],'æœ¬é€±æ·±åº¦æ®µæ•¸'); ring(c2, 45, 'ä»Šæ—¥å°ˆæ³¨(åˆ†)'); }
  },
  habit:{name:'ç¿’æ…£å½¢æˆ', desc:'è§¸ç™¼â†’è¡Œç‚ºâ†’çè³',
    intro:['æ¯æ—¥é€£å‹èˆ‡çè³ï¼Œè®“è¡Œç‚ºè‡ªå‹•åŒ–'],
    questions:[{k:'habit',l:'ä½ è¦å»ºç«‹çš„ç¿’æ…£æ˜¯ï¼Ÿ'},{k:'time',l:'æ¯å¤©ä½•æ™‚åŸ·è¡Œï¼Ÿ'},{k:'streak',l:'ç›®æ¨™é€£å‹å¤©æ•¸ï¼Ÿ'}],
    makeTasks:(g,v)=>{ const out=[]; for(let i=0;i<parseInt(v.streak||'21',10);i++){ const d=new Date(); d.setDate(d.getDate()+i); out.push({id:uid(),goal_id:g.id,title:`ç¿’æ…£æ‰“å¡ï¼š${v.habit||'æ–°ç¿’æ…£'}`,type:'habit',estimate_min:5,due_date:d.toISOString().slice(0,10),status:'pending'});} return out;},
    charts:(c1,c2)=>{ spark(c1,[0,1,2,3,4,5,6],'é€£å‹'); ring(c2, 3, 'ä»Šæ—¥æ‰“å¡'); }
  },
  kaizen_kanban:{name:'Kaizen Ã— çœ‹æ¿', desc:'å°æ­¥å¿«è·‘ + æµç¨‹å¯è¦–åŒ–',
    intro:['é™åˆ¶ WIPï¼Œé™ä½å¤šå·¥åˆ‡æ›æˆæœ¬'],
    questions:[{k:'todo',l:'å¾…è¾¦ï¼ˆé€—è™Ÿåˆ†éš”ï¼‰'},{k:'wip',l:'WIP ä¸Šé™ï¼ˆæ•¸å­—ï¼‰'}],
    makeTasks:(g,v)=>{ const out=[];(v.todo||'').split(',').map(s=>s.trim()).filter(Boolean).forEach(x=> out.push({id:uid(),goal_id:g.id,title:x,type:'kanban',estimate_min:25,due_date:todayISO(),status:'pending'})); return out;},
    charts:(c1,c2)=>{ bars(c1,[3,2,1],'ToDo/Doing/Done'); ring(c2, 2, 'ç•¶å‰ WIP'); }
  },
  woop_pomodoro:{name:'WOOP Ã— ç•ªèŒ„', desc:'å¿ƒç†å°æ¯” + ç•ªèŒ„è¡Œå‹•',
    intro:['æŠŠéšœç¤™å°ç­–åŒ–ç‚ºç•ªèŒ„ä»»å‹™ï¼Œé‚Šæƒ³é‚Šåš'],
    questions:[{k:'wish',l:'é¡˜æœ›æ˜¯ï¼Ÿ'},{k:'obstacle',l:'éšœç¤™æ˜¯ï¼Ÿ'},{k:'plan',l:'å°ç­–æ˜¯ï¼Ÿ'},{k:'rounds',l:'å•Ÿå‹•å¹¾å€‹ç•ªèŒ„ï¼Ÿ(æ•¸å­—)'}],
    makeTasks:(g,v)=>{ const out=[]; const n=Math.max(1,parseInt(v.rounds||'3',10)); for(let i=1;i<=n;i++){ out.push({id:uid(),goal_id:g.id,title:`ç•ªèŒ„ ${i}/${n}ï¼š${v.plan||'åŸ·è¡Œå°ç­–'}`,type:'woop-pomodoro',estimate_min:25,due_date:todayISO(),status:'pending'});} return out;},
    charts:(c1,c2)=>{ bars(c1,[1,2,3],'ç•ªèŒ„é€²åº¦'); ring(c2, 50, 'å°ç­–è½åœ°ç‡'); }
  }
};

// ===== åˆå§‹åŒ–é é¢ =====
const id = qs('id');
const M = METHODS[id] || METHODS.smart;

document.getElementById('methodTitle').textContent = M.name;
document.getElementById('methodDesc').textContent = M.desc;

// ç°¡ä»‹
const intro = document.getElementById('intro');
intro.innerHTML = `<div style="font-weight:700; margin-bottom:6px">${M.name} Â· æ–¹æ³•ç°¡ä»‹</div>`+
  `<ul class="muted" style="margin:6px 0 0 18px; line-height:1.7">`+
  M.intro.map(x=>`<li>${x}</li>`).join('')+
  `</ul>`;

// å•é¡Œè¡¨å–®
const form = document.getElementById('guideForm');
form.innerHTML = M.questions.map(q=>`<div style="margin-bottom:10px"><label>${q.l}</label><input id="q_${q.k}"></div>`).join('');

// ç°¡æ˜“åœ–è¡¨å·¥å…·ï¼ˆç„¡å¤–æ›ï¼‰
function ring(canvas, value, label){ const ctx=canvas.getContext('2d'); const w=canvas.width=canvas.clientWidth, h=canvas.height=canvas.clientHeight; const r=Math.min(w,h)/2-14; const cx=w/2, cy=h/2; ctx.clearRect(0,0,w,h); ctx.lineWidth=12; ctx.strokeStyle='rgba(255,255,255,0.1)'; ctx.beginPath(); ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke(); ctx.strokeStyle='rgba(102,126,234,0.85)'; ctx.beginPath(); ctx.arc(cx,cy,r,-Math.PI/2,-Math.PI/2+Math.PI*2*(Math.max(0,Math.min(100,value))/100)); ctx.stroke(); ctx.fillStyle='#e5e7eb'; ctx.font='700 18px system-ui'; ctx.textAlign='center'; ctx.fillText(`${label}`,cx,cy-4); ctx.font='700 22px system-ui'; ctx.fillText(`${value}%`,cx,cy+22); }
function bars(canvas, arr, label){ const ctx=canvas.getContext('2d'); const w=canvas.width=canvas.clientWidth, h=canvas.height=canvas.clientHeight; ctx.clearRect(0,0,w,h); const m=24; const ww=(w-m*2)/arr.length; const max=Math.max(...arr,1); ctx.fillStyle='rgba(102,126,234,0.9)'; arr.forEach((v,i)=>{ const bh=(h-m*2)*(v/max); ctx.fillRect(m+i*ww, h-m-bh, ww*0.7, bh); }); ctx.fillStyle='#e5e7eb'; ctx.font='700 14px system-ui'; ctx.fillText(label||'', m, 18); }
function spark(canvas, arr, label){ const ctx=canvas.getContext('2d'); const w=canvas.width=canvas.clientWidth, h=canvas.height=canvas.clientHeight; ctx.clearRect(0,0,w,h); const m=18; const max=Math.max(...arr,1), min=Math.min(...arr); ctx.strokeStyle='rgba(102,126,234,0.9)'; ctx.lineWidth=2; ctx.beginPath(); arr.forEach((v,i)=>{ const x=m+i*( (w-m*2)/(arr.length-1||1) ); const y=h-m-( (h-m*2) * ( (v-min)/(max-min||1) ) ); if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y); }); ctx.stroke(); ctx.fillStyle='#e5e7eb'; ctx.font='700 14px system-ui'; ctx.fillText(label||'', m, 18); }
function quad(canvas,q){ const ctx=canvas.getContext('2d'); const w=canvas.width=canvas.clientWidth, h=canvas.height=canvas.clientHeight; ctx.clearRect(0,0,w,h); ctx.strokeStyle='rgba(255,255,255,0.2)'; ctx.strokeRect(1,1,w-2,h-2); ctx.fillStyle='rgba(102,126,234,0.85)'; const cw=w/2,ch=h/2; ctx.globalAlpha=0.85; ctx.fillRect(0,0,cw,ch*(q.q1||0)/6); ctx.fillRect(cw,0,cw,ch*(q.q2||0)/6); ctx.fillRect(0,ch,cw,ch*(q.q3||0)/6); ctx.fillRect(cw,ch,cw,ch*(q.q4||0)/6); ctx.globalAlpha=1; ctx.fillStyle='#e5e7eb'; ctx.font='700 14px system-ui'; ctx.fillText('Q1 Q2 Q3 Q4', 10, 18); }
function v2n(k){ const el=document.getElementById('q_'+k); const n=parseFloat(el?.value||'0'); return isNaN(n)?0:n; }

// åˆå§‹åŒ–åœ–è¡¨
M.charts(document.getElementById('chart1'), document.getElementById('chart2'));

// é è¦½ / å»ºç«‹
function gather(){ const v={}; M.questions.forEach(q=> v[q.k] = (document.getElementById('q_'+q.k)?.value||'').trim()); return v; }
function previewPlan(e){ e.preventDefault(); const v=gather(); alert('è¨ˆç•«é è¦½\n'+JSON.stringify(v,null,2)); }
function createPlan(e){ e.preventDefault(); const v=gather(); const title = M.name + ' è¨ˆç•«'; const dfltDeadline = (()=>{const d=new Date(); d.setDate(d.getDate()+30); return d.toISOString().slice(0,10)})(); const g = {id:uid(), title, deadline:dfltDeadline, weekly_hours:6, status:'active', progress:0, notes:'method:'+id, created_at:new Date().toISOString()}; const tasks = (M.makeTasks(g,v)||[]); // ç¢ºä¿ä»Šå¤©è‡³å°‘ 1 ä»»å‹™
 if(!tasks.some(t=>t.due_date===todayISO())) tasks.unshift({id:uid(),goal_id:g.id,title:'å•Ÿå‹•ï¼šèŠ± 15 åˆ†é˜å•Ÿå‹•',type:'start',estimate_min:15,due_date:todayISO(),status:'pending'});
 state.goals.push(g); state.tasks = state.tasks.concat(tasks); state.activeGoalId=g.id; save('dreampath', state); location.href='index.html'; }
</script>
</body>
</html>